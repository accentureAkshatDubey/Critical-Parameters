version: 0.0.5
jobId: "1059"
jobName: Vendor Critical Parameter Details
jobType: Aggregated Data Product
domain: quality_assurance
alias: iceberg_load
discoveryPort:
  name: Vendor Critical Parameter Details
inputPorts:
  - alias: Critical_Parameter_Details_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:b9c4d42c-52a2-4858-813c-f5d2cf7050dd
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
productState:
  isDynamic: true
  alias: iceberg_load
  retentionVersions: ""
  logicalSchema:
    properties:
      username:
        type: STRING
        description: MSIL Concered Department UserName
        sourceColumn: username
        sourceTable: Critical parameter details
      part_user_dept:
        type: STRING
        description: Department ID of User
        sourceColumn: part_user_dept
        sourceTable: Critical parameter details
      insp_part_code:
        type: STRING
        description: Code of inspection item
        sourceColumn: insp_part_code
        sourceTable: Critical parameter details
      insp_sr_no:
        type: STRING
        description: Serial Number of Inspection Item
        sourceColumn: insp_sr_no
        sourceTable: Critical parameter details
      part_desc:
        type: STRING
        description: Part Description
        sourceColumn: part_desc
        sourceTable: Critical parameter details
      part_vend_code:
        type: STRING
        description: Vendor Code supplying the part
        sourceColumn: part_vend_code
        sourceTable: Critical parameter details
      part_vend_desc:
        type: STRING
        description: Vendor Description
        sourceColumn: part_vend_desc
        sourceTable: Critical parameter details
      part_modl:
        type: STRING
        description: part model
        sourceColumn: part_modl
        sourceTable: Critical parameter details
      insp_item:
        type: STRING
        description: Inspection Item
        sourceColumn: insp_item
        sourceTable: Critical parameter details
      insp_from_date:
        type: STRING
        description: From date field of inspection item
        sourceColumn: insp_from_date
        sourceTable: Critical parameter details
      insp_to_date:
        type: STRING
        description: To Date field of inspection item
        sourceColumn: insp_to_date
        sourceTable: Critical parameter details
      tran_prod_date:
        type: STRING
        description: Production Date of Component
        sourceColumn: tran_prod_date
        sourceTable: Critical parameter details
      tran_line_code:
        type: STRING
        description: Line Description
        sourceColumn: tran_line_code
        sourceTable: Critical parameter details
      tran_shift:
        type: STRING
        description: Shift Name
        sourceColumn: tran_shift
        sourceTable: Critical parameter details
      tran_btch_code:
        type: STRING
        description: Batch Code
        sourceColumn: tran_btch_code
        sourceTable: Critical parameter details
      tran_prod_stats:
        type: STRING
        description: Prod stats
        sourceColumn: tran_prod_stats
        sourceTable: Critical parameter details
      tran_prod_count:
        type: STRING
        description: "Unique Number added "
        sourceColumn: tran_prod_count
        sourceTable: Critical parameter details
      insp_base_value:
        type: STRING
        description: Mean(Provided in system)
        sourceColumn: insp_base_value
        sourceTable: Critical parameter details
      insp_ltlr:
        type: STRING
        description: LSL -Lower spec limit
        sourceColumn: insp_ltlr
        sourceTable: Critical parameter details
      insp_utlr:
        type: STRING
        description: USL - Upper spec limit
        sourceColumn: insp_utlr
        sourceTable: Critical parameter details
      insp_unit:
        type: STRING
        description: Dimension (cm,mm, etc)
        sourceColumn: insp_unit
        sourceTable: Critical parameter details
      part_catg:
        type: STRING
        description: A/R/AR
        sourceColumn: part_catg
        sourceTable: Critical parameter details
      insp_smpl_cnt:
        type: STRING
        description: Number of samples available for Cosideration
        sourceColumn: insp_smpl_cnt
        sourceTable: Critical parameter details
      tran_sample1:
        type: STRING
        description: 1st sample value entered by vendor
        sourceColumn: tran_sample1
        sourceTable: Critical parameter details
      tran_sample2:
        type: STRING
        description: 2nd sample value entered by vendor
        sourceColumn: tran_sample2
        sourceTable: Critical parameter details
      tran_sample3:
        type: STRING
        description: 3rd sample value entered by vendor
        sourceColumn: tran_sample3
        sourceTable: Critical parameter details
      tran_sample4:
        type: STRING
        description: 4th sample value entered by vendor
        sourceColumn: tran_sample4
        sourceTable: Critical parameter details
      tran_sample5:
        type: STRING
        description: 5th sample value entered by vendor
        sourceColumn: tran_sample5
        sourceTable: Critical parameter details
      tran_sample6:
        type: STRING
        description: 6th sample value entered by vendor
        sourceColumn: tran_sample6
        sourceTable: Critical parameter details
      tran_sample7:
        type: STRING
        description: 7th sample value entered by vendor
        sourceColumn: tran_sample7
        sourceTable: Critical parameter details
      tran_sample8:
        type: STRING
        description: 8th sample value entered by vendor
        sourceColumn: tran_sample8
        sourceTable: Critical parameter details
      tran_sample9:
        type: STRING
        description: 9th sample value entered by vendor
        sourceColumn: tran_sample9
        sourceTable: Critical parameter details
      tran_sample10:
        type: STRING
        description: 10th sample value entered by vendor
        sourceColumn: tran_sample10
        sourceTable: Critical parameter details
      counta:
        type: STRING
        description: Unique number for each sample value in defined composite key
        sourceColumn: counta
        sourceTable: Critical parameter details
      min:
        type: STRING
        description: Min of all samples
        sourceColumn: min
        sourceTable: Critical parameter details
      max:
        type: STRING
        description: Max of all samples
        sourceColumn: max
        sourceTable: Critical parameter details
      range:
        type: STRING
        description: Difference of Max and Min
        sourceColumn: range
        sourceTable: Critical parameter details
      mean:
        type: STRING
        description: mean of samples
        sourceColumn: mean
        sourceTable: Critical parameter details
      prev_value:
        type: STRING
        description: previous entry in sample 1
        sourceColumn: prev_value
        sourceTable: Critical parameter details
      moving_range:
        type: STRING
        description: in case of sample count 1, this field is required to calculate range
        sourceColumn: moving_range
        sourceTable: Critical parameter details
      xbb:
        type: STRING
        description: mean of mean column
        sourceColumn: xbb
        sourceTable: Critical parameter details
      rbar:
        type: STRING
        description: Row by agonizing row
        sourceColumn: rbar
        sourceTable: Critical parameter details
      sigma:
        type: STRING
        description: Standard Deviation
        sourceColumn: sigma
        sourceTable: Critical parameter details
      cp:
        type: STRING
        description: Critical Parameter
        sourceColumn: cp
        sourceTable: Critical parameter details
      cpl:
        type: STRING
        description: Lower CP
        sourceColumn: cpl
        sourceTable: Critical parameter details
      cpu:
        type: STRING
        description: Upper CP
        sourceColumn: cpu
        sourceTable: Critical parameter details
      cpk:
        type: STRING
        description: Critical Parameter Indices
        sourceColumn: cpk
        sourceTable: Critical parameter details
      xbar_ucl:
        type: STRING
        description: Xbar Upper Control Limit
        sourceColumn: xbar_ucl
        sourceTable: Critical parameter details
      xbar_lcl:
        type: STRING
        description: Xbar Lower Control Limit
        sourceColumn: xbar_lcl
        sourceTable: Critical parameter details
      rchart_ucl:
        type: STRING
        description: R Chart Upper Control Limit
        sourceColumn: rchart_ucl
        sourceTable: Critical parameter details
      rchart_lcl:
        type: STRING
        description: R Chart Lower Control Limit
        sourceColumn: rchart_lcl
        sourceTable: Critical parameter details
      xchart_ucl:
        type: STRING
        description: X Chart Upper Control Limit
        sourceColumn: xchart_ucl
        sourceTable: Critical parameter details
      xchart_lcl:
        type: STRING
        description: X Chart Lower Control Limit
        sourceColumn: xchart_lcl
        sourceTable: Critical parameter details
      mrchart_ucl:
        type: STRING
        description: MR Chart Upper Control Limit
        sourceColumn: mrchart_ucl
        sourceTable: Critical parameter details
      mrchart_lcl:
        type: STRING
        description: MR Chart Lower Control Limit
        sourceColumn: mrchart_lcl
        sourceTable: Critical parameter details
      flag_usl_lsl:
        type: STRING
        description: If any sample value is less than LSL and greater than USL, then
          this flag will be true
        sourceColumn: flag_usl_lsl
        sourceTable: Critical parameter details
      flag_xbar_ucl_lcl:
        type: STRING
        description: If any mean value is breaching the Xbar UCL LCL Limit, then this
          flag will be true
        sourceColumn: flag_xbar_ucl_lcl
        sourceTable: Critical parameter details
      flag_rchart_ucl_lcl:
        type: STRING
        description: If any range value is breaching the Rchart UCL LCL Limit, then this
          flag will be true
        sourceColumn: flag_rchart_ucl_lcl
        sourceTable: Critical parameter details
      flag_xchart_ucl_lcl:
        type: STRING
        description: If any mean value is breaching the XChart UCL LCL Limit, then this
          flag will be true
        sourceColumn: flag_xchart_ucl_lcl
        sourceTable: Critical parameter details
      flag_mrchart_ucl_lcl:
        type: STRING
        description: If any moving range value is breaching the Rchart UCL LCL Limit,
          then this flag will be true
        sourceColumn: flag_mrchart_ucl_lcl
        sourceTable: Critical parameter details
      validation_usl_lsl:
        type: STRING
        description: Flag to check if Cp flag is greater than Cpk
        sourceColumn: validation_usl_lsl
        sourceTable: Critical parameter details
      cp_flag:
        type: STRING
        description: Flag to categorise cp values in low, medium or high
        sourceColumn: cp_flag
        sourceTable: Critical parameter details
      cpk_flag:
        type: STRING
        description: Flag to categorise cpk values in low, medium or high
        sourceColumn: cpk_flag
        sourceTable: Critical parameter details
      continous_flag_alert:
        type: STRING
        description: If mean value is increasing or decreasing continously for 7 days,
          this flag will be set to 1
        sourceColumn: continous_flag_alert
        sourceTable: Critical parameter details
      alert_details:
        type: STRING
        description: categorise the alerts in Beyond Control Limit, Beyond Spec Limit,
          Beyond Control Band, 7 points up or down
        sourceColumn: alert_details
        sourceTable: Critical parameter details
      _7_points_up:
        type: STRING
        description: If mean value is increasing continously for 7 days
        sourceColumn: "`_7_points_up`"
        sourceTable: Critical parameter details
      _7_points_down:
        type: STRING
        description: If mean value is increasing decreasing for 7 days
        sourceColumn: "`_7_points_down`"
        sourceTable: Critical parameter details
      runchart_ucl:
        type: STRING
        description: Upper control band limit with 80% margin
        sourceColumn: runchart_ucl
        sourceTable: Critical parameter details
      runchart_lcl:
        type: STRING
        description: Lower control band limit with 80% margin
        sourceColumn: runchart_lcl
        sourceTable: Critical parameter details
      insp_smpl_feq:
        type: STRING
        description: smpl feq
        sourceColumn: insp_smpl_feq
        sourceTable: Critical parameter details
      insp_part_rmrk:
        type: STRING
        description: Part remarks
        sourceColumn: insp_part_rmrk
        sourceTable: Critical parameter details
      insp_ctrl_limt:
        type: STRING
        description: Control limit
        sourceColumn: insp_ctrl_limt
        sourceTable: Critical parameter details
      insp_ctrl_point:
        type: STRING
        description: Control point
        sourceColumn: insp_ctrl_point
        sourceTable: Critical parameter details
      insp_ctrl_band:
        type: STRING
        description: Control band
        sourceColumn: insp_ctrl_band
        sourceTable: Critical parameter details
      insp_close_alrt:
        type: STRING
        description: Close alert
        sourceColumn: insp_close_alrt
        sourceTable: Critical parameter details
      insp_src:
        type: STRING
        description: Source
        sourceColumn: insp_src
        sourceTable: Critical parameter details
      insp_catg:
        type: STRING
        description: Category
        sourceColumn: insp_catg
        sourceTable: Critical parameter details
      insp_misp_plan:
        type: STRING
        description: misp plan
        sourceColumn: insp_misp_plan
        sourceTable: Critical parameter details
      attribute:
        type: STRING
        description: attribute
        sourceColumn: attribute
        sourceTable: Critical parameter details
      value:
        type: STRING
        description: value
        sourceColumn: value
        sourceTable: Critical parameter details
      lower_value_uni:
        type: STRING
        description: lower value
        sourceColumn: lower_value_uni
        sourceTable: Critical parameter details
      upper_value_uni:
        type: STRING
        description: upper value
        sourceColumn: upper_value_uni
        sourceTable: Critical parameter details
      uni_values:
        type: STRING
        description: ""
        sourceColumn: uni_values
        sourceTable: Critical parameter details
      control_band_percent:
        type: STRING
        description: control band %
        sourceColumn: control_band_percent
        sourceTable: Critical parameter details
      ucl:
        type: STRING
        description: upper control limit
        sourceColumn: ucl
        sourceTable: Critical parameter details
      lcl:
        type: STRING
        description: lower control limit
        sourceColumn: lcl
        sourceTable: Critical parameter details
      etl_inserted_date:
        type: DATETIME
        description: ETL Audit Field to identify record insertion date
        sourceColumn: Manual
        sourceTable: Manual
      etl_modified_date:
        type: DATETIME
        description: ETL Audit Field to identify record modified date
        sourceColumn: Manual
        sourceTable: Manual
      etl_created_by:
        type: STRING
        description: ETL Audit Field to identify record created by user
        sourceColumn: Manual
        sourceTable: Manual
      etl_updated_by:
        type: STRING
        description: ETL Audit Field to identify record modified by user
        sourceColumn: Manual
        sourceTable: Manual
  stateStoreType: loadDataIceberg
  isProfilingEnabled: false
  updateStrategy: Overwrite
  tableName: msil_dataverse_quality_assurance_catalog.vendor_critical_parameter_details
  warehousePath: s3://msil-dataverse-quality-assurance/
  catalogName: glue
  optional:
    persistDataFrame: false
    enableDataReconciliation: false
    enforceSchema: false
    enforceSchemaMethod: Warning
    catalogType: glue
  refreshInterval: None
transformation:
  - isDynamic: true
    alias: Spark_SQL_1
    description: data transform
    sequence: 2
    inputDataFrameList:
      - inputDataFrame: Critical_Parameter_Details_1
        tempViewName: critical_parameter_details
    query: select  * ,  case   when coalesce(insp_utlr,   0) != 0   and
      coalesce(insp_ltlr,   0) != 0 then coalesce(insp_utlr,   0) -
      (coalesce(insp_utlr,   0)-coalesce(insp_ltlr,   0))*
      control_band_percent   when coalesce(insp_utlr,   0) != 0   and
      coalesce(insp_ltlr,   0) = 0 then coalesce(insp_utlr,   0) -
      ABS(coalesce(insp_utlr,   0)* control_band_percent)   when
      coalesce(insp_utlr,   0) = 0   and coalesce(insp_ltlr,   0) != 0 then
      ''   else 0  end as ucl ,  case   when coalesce(insp_utlr,   0) != 0   and
      coalesce(insp_ltlr,   0) != 0 then coalesce(insp_utlr,   0) +
      (coalesce(insp_utlr,   0)-coalesce(insp_ltlr,   0))*
      control_band_percent   when coalesce(insp_utlr,   0) != 0   and
      coalesce(insp_ltlr,   0) = 0 then ''   when coalesce(insp_utlr,   0) =
      0   and coalesce(insp_ltlr,   0) != 0 then coalesce(insp_ltlr,   0) +
      ABS(coalesce(insp_ltlr,   0)* control_band_percent)   else 0  end as
      lcl,  current_timestamp() as etl_inserted_date,  current_timestamp() as
      etl_modified_date,  'platform_admin' as etl_created_by,  'platform_admin'
      as etl_updated_by from  (  select   username ,   part_user_dept
      ,   insp_part_code ,   insp_sr_no ,   part_desc ,   part_vend_code
      ,   part_vend_desc ,   part_modl ,   insp_item ,   insp_from_date
      ,   insp_to_date ,   tran_prod_date ,   tran_line_code ,   tran_shift
      ,   tran_btch_code ,   tran_prod_stats ,   tran_prod_count
      ,   insp_base_value ,   insp_ltlr ,   insp_utlr ,   insp_unit
      ,   part_catg ,   insp_smpl_cnt ,   tran_sample1 ,   tran_sample2
      ,   tran_sample3 ,   tran_sample4 ,   tran_sample5 ,   tran_sample6
      ,   tran_sample7 ,   tran_sample8 ,   tran_sample9 ,   tran_sample10
      ,   counta ,   min ,   max ,   range ,   mean ,   prev_value
      ,   moving_range ,   xbb ,   rbar ,   sigma ,   cp ,   cpl ,   cpu ,   cpk
      ,   xbar_ucl ,   xbar_lcl ,   rchart_ucl ,   rchart_lcl ,   xchart_ucl
      ,   xchart_lcl ,   mrchart_ucl ,   mrchart_lcl ,   flag_usl_lsl
      ,   flag_xbar_ucl_lcl ,   flag_rchart_ucl_lcl ,   flag_xchart_ucl_lcl
      ,   flag_mrchart_ucl_lcl ,   validation_usl_lsl ,   cp_flag ,   cpk_flag
      ,   continous_flag_alert ,   alert_details ,   `_7_points_up`
      ,   `_7_points_down` ,   runchart_ucl ,   runchart_lcl ,   insp_smpl_feq
      ,   insp_part_rmrk ,   insp_ctrl_limt ,   insp_ctrl_point
      ,   insp_ctrl_band ,   insp_close_alrt ,   insp_src ,   insp_catg
      ,   insp_misp_plan ,   case    when seq_num = 1 then 'SAMPLE 1'    when
      seq_num = 2 then 'SAMPLE 2'    when seq_num = 3 then 'SAMPLE 3'    when
      seq_num = 4 then 'SAMPLE 4'    when seq_num = 5 then 'SAMPLE 5'    when
      seq_num = 6 then 'SAMPLE 6'    when seq_num = 7 then 'SAMPLE 7'    when
      seq_num = 8 then 'SAMPLE 8'    when seq_num = 9 then 'SAMPLE 9'    when
      seq_num = 10 then 'SAMPLE 10'   end as attribute ,   case    when seq_num
      = 1 then TRAN_SAMPLE1    when seq_num = 2 then TRAN_SAMPLE2    when
      seq_num = 3 then TRAN_SAMPLE3    when seq_num = 4 then
      TRAN_SAMPLE4    when seq_num = 5 then TRAN_SAMPLE5    when seq_num = 6
      then TRAN_SAMPLE6    when seq_num = 7 then TRAN_SAMPLE7    when seq_num =
      8 then TRAN_SAMPLE8    when seq_num = 9 then TRAN_SAMPLE9    when seq_num
      = 10 then TRAN_SAMPLE10   end as value ,   coalesce(insp_ltlr,   0) as
      lower_value_uni ,   coalesce(insp_utlr,   0) as upper_value_uni
      ,   case    when coalesce(insp_ltlr,    0) != 0    and
      coalesce(insp_utlr,    0) != 0 then 1    else 0   end as uni_values
      ,   case    when coalesce(insp_ltlr,    0) != 0    and
      coalesce(insp_utlr,    0) != 0 then (100-insp_ctrl_band)/ 200    when
      coalesce(insp_utlr,    0) != 0    and coalesce(insp_ltlr,    0) = 0 then
      (100-insp_ctrl_band)/ 100    when coalesce(insp_utlr,    0) = 0    and
      coalesce(insp_ltlr,    0) != 0 then (100-insp_ctrl_band)/ 100   end as
      control_band_percent  from   (   select    *
      ,    EXPLODE(sequence(1,    10))
      SEQ_NUM   from    critical_parameter_details )
      CRITICAL_PARAMETER_DETAILS_SEQ ) ;
    optional:
      persistDataFrame: false
    type: operationThroughSqlQuery
controlPort:
  dataQualityRules: {}
outputPort:
  subscriptionChannels:
    - channelType: Postgres
      queryType: SQL
    - channelType: Dataproduct
      queryType: SQL
