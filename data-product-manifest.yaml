version: 0.0.10
jobId: "1057"
jobName: Critical Parameter Details
jobType: Aggregated Data Product
domain: quality_assurance
alias: Write_to_Iceberg
discoveryPort:
  name: Critical Parameter Details
inputPorts:
  - alias: Employee_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:e0432435-1609-43cf-95eb-1396c4ce4c73
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: Inspection_Item_Parameter_Detail_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:1ece1da2-b682-4525-b595-b9ba375a48a4
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
  - alias: Parts_Accessories_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:3ace113a-e949-4884-8b02-e1caddfcc28b
    filter: ""
    projection: ""
    optional:
      persistDataFrame: false
    type: dataproduct
productState:
  persistDataFrame: false
  catalogType: glue
  enforceSchema: false
  stepName: Write to Iceberg
  tableName: msil_dataverse_quality_assurance_catalog.critical_parameter_details
  warehousePath: s3://msil-dataverse-quality-assurance/
  catalogName: glue
  type: readDataIceberg
  isStateManagement: true
  sequence: 5
  alias: Write_to_Iceberg
  refreshInterval: None
  retentionVersions: ""
  logicalSchema:
    properties:
      username:
        type: STRING
        description: msil concered department username
        sourceColumn: username
        sourceTable: fpay_empl,qacp_part
      part_user_dept:
        type: STRING
        description: department id of user
        sourceColumn: part_user_dept
        sourceTable: qacp_part
      insp_part_code:
        type: STRING
        description: code of inspection item
        sourceColumn: insp_part_code
        sourceTable: qacp_insp_item
      insp_sr_no:
        type: STRING
        description: serial number of inspection item
        sourceColumn: insp_sr_no
        sourceTable: qacp_insp_item
      part_desc:
        type: STRING
        description: part description
        sourceColumn: part_desc
        sourceTable: qacp_part
      part_vend_code:
        type: STRING
        description: vendor code supplying the part
        sourceColumn: part_vend_code
        sourceTable: qacp_part
      part_vend_desc:
        type: STRING
        description: vendor description
        sourceColumn: part_vend_desc
        sourceTable: qacp_part
      part_modl:
        type: STRING
        description: "model of part "
        sourceColumn: part_modl
        sourceTable: qacp_part
      insp_item:
        type: STRING
        description: inspection item
        sourceColumn: insp_item
        sourceTable: qacp_insp_item
      insp_from_date:
        type: STRING
        description: from date field of inspection item
        sourceColumn: insp_from_date
        sourceTable: qacp_insp_item
      insp_to_date:
        type: STRING
        description: to date field of inspection item
        sourceColumn: insp_to_date
        sourceTable: qacp_insp_item
      tran_prod_date:
        type: STRING
        description: production date of component
        sourceColumn: tran_prod_date
        sourceTable: qacp_tran
      tran_line_code:
        type: STRING
        description: line description
        sourceColumn: tran_line_code
        sourceTable: qacp_tran
      tran_shift:
        type: STRING
        description: shift name
        sourceColumn: tran_shift
        sourceTable: qacp_tran
      tran_btch_code:
        type: STRING
        description: batch code
        sourceColumn: tran_btch_code
        sourceTable: qacp_tran
      tran_prod_stats:
        type: STRING
        description: prod stats
        sourceColumn: tran_prod_stats
        sourceTable: qacp_tran
      tran_prod_count:
        type: STRING
        description: unique number added by ishan
        sourceColumn: tran_prod_count
        sourceTable: qacp_tran
      insp_base_value:
        type: STRING
        description: mean(provided in system)
        sourceColumn: insp_base_value
        sourceTable: qacp_insp_item
      insp_ltlr:
        type: STRING
        description: lsl -lower spec limit
        sourceColumn: insp_ltlr
        sourceTable: qacp_insp_item
      insp_utlr:
        type: STRING
        description: usl - upper spec limit
        sourceColumn: insp_utlr
        sourceTable: qacp_insp_item
      insp_unit:
        type: STRING
        description: dimension (cm,mm, etc)
        sourceColumn: insp_unit
        sourceTable: qacp_insp_item
      part_catg:
        type: STRING
        description: a/r/ar
        sourceColumn: part_catg
        sourceTable: qacp_part
      insp_smpl_cnt:
        type: STRING
        description: number of samples available for cosideration
        sourceColumn: insp_smpl_cnt
        sourceTable: qacp_insp_item
      sm1:
        type: STRING
        description: ng/none
        sourceColumn: sm1
        sourceTable: ""
      tran_sample1:
        type: STRING
        description: 1st sample value entered by vendor
        sourceColumn: tran_sample1
        sourceTable: qacp_tran
      sm2:
        type: STRING
        description: ng/none
        sourceColumn: sm2
        sourceTable: ""
      tran_sample2:
        type: STRING
        description: 2nd sample value entered by vendor
        sourceColumn: tran_sample2
        sourceTable: qacp_tran
      sm3:
        type: STRING
        description: ng/none
        sourceColumn: sm3
        sourceTable: ""
      tran_sample3:
        type: STRING
        description: 3rd sample value entered by vendor
        sourceColumn: tran_sample3
        sourceTable: qacp_tran
      sm4:
        type: STRING
        description: ng/none
        sourceColumn: sm4
        sourceTable: ""
      tran_sample4:
        type: STRING
        description: 4th sample value entered by vendor
        sourceColumn: tran_sample4
        sourceTable: qacp_tran
      sm5:
        type: STRING
        description: ng/none
        sourceColumn: sm5
        sourceTable: ""
      tran_sample5:
        type: STRING
        description: 5th sample value entered by vendor
        sourceColumn: tran_sample5
        sourceTable: qacp_tran
      sm6:
        type: STRING
        description: ng/none
        sourceColumn: sm6
        sourceTable: ""
      tran_sample6:
        type: STRING
        description: 6th sample value entered by vendor
        sourceColumn: tran_sample6
        sourceTable: qacp_tran
      sm7:
        type: STRING
        description: ng/none
        sourceColumn: sm7
        sourceTable: ""
      tran_sample7:
        type: STRING
        description: 7th sample value entered by vendor
        sourceColumn: tran_sample7
        sourceTable: qacp_tran
      sm8:
        type: STRING
        description: ng/none
        sourceColumn: sm8
        sourceTable: ""
      tran_sample8:
        type: STRING
        description: 8th sample value entered by vendor
        sourceColumn: tran_sample8
        sourceTable: qacp_tran
      sm9:
        type: STRING
        description: ng/none
        sourceColumn: sm9
        sourceTable: ""
      tran_sample9:
        type: STRING
        description: 9th sample value entered by vendor
        sourceColumn: tran_sample9
        sourceTable: qacp_tran
      sm10:
        type: STRING
        description: ng/none
        sourceColumn: sm10
        sourceTable: ""
      tran_sample10:
        type: STRING
        description: 10th sample value entered by vendor
        sourceColumn: tran_sample10
        sourceTable: qacp_tran
      counta:
        type: STRING
        description: unique number for each sample value in defined composite key
        sourceColumn: counta
        sourceTable: ""
      min:
        type: STRING
        description: min of all samples
        sourceColumn: min
        sourceTable: ""
      max:
        type: STRING
        description: max of all samples
        sourceColumn: max
        sourceTable: ""
      range:
        type: STRING
        description: difference of max and min
        sourceColumn: range
        sourceTable: ""
      mean:
        type: STRING
        description: mean of samples
        sourceColumn: mean
        sourceTable: ""
      prev_value:
        type: STRING
        description: previous entry in sample 1
        sourceColumn: prev_value
        sourceTable: ""
      moving_range:
        type: STRING
        description: in case of sample count 1, this field is required to calculate range
        sourceColumn: moving_range
        sourceTable: ""
      xbb:
        type: STRING
        description: mean of mean column
        sourceColumn: xbb
        sourceTable: ""
      rbar:
        type: STRING
        description: row by agonizing row
        sourceColumn: rbar
        sourceTable: ""
      sigma:
        type: STRING
        description: standard deviation
        sourceColumn: sigma
        sourceTable: ""
      cp:
        type: STRING
        description: critical parameter
        sourceColumn: cp
        sourceTable: ""
      cpl:
        type: STRING
        description: lower cp
        sourceColumn: cpl
        sourceTable: ""
      cpu:
        type: STRING
        description: upper cp
        sourceColumn: cpu
        sourceTable: ""
      cpk:
        type: STRING
        description: critical parameter indices
        sourceColumn: cpk
        sourceTable: ""
      xbar_ucl:
        type: STRING
        description: xbar upper control limit
        sourceColumn: xbar_ucl
        sourceTable: ""
      xbar_lcl:
        type: STRING
        description: xbar lower control limit
        sourceColumn: xbar_lcl
        sourceTable: ""
      rchart_ucl:
        type: STRING
        description: r chart upper control limit
        sourceColumn: rchart_ucl
        sourceTable: ""
      rchart_lcl:
        type: STRING
        description: r chart lower control limit
        sourceColumn: rchart_lcl
        sourceTable: ""
      xchart_ucl:
        type: STRING
        description: x chart upper control limit
        sourceColumn: xchart_ucl
        sourceTable: ""
      xchart_lcl:
        type: STRING
        description: x chart lower control limit
        sourceColumn: xchart_lcl
        sourceTable: ""
      mrchart_ucl:
        type: STRING
        description: mr chart upper control limit
        sourceColumn: mrchart_ucl
        sourceTable: ""
      mrchart_lcl:
        type: STRING
        description: mr chart lower control limit
        sourceColumn: mrchart_lcl
        sourceTable: ""
      flag_usl_lsl:
        type: STRING
        description: if any sample value is less than lsl and greater than usl, then
          this flag will be true
        sourceColumn: flag_usl_lsl
        sourceTable: ""
      flag_xbar_ucl_lcl:
        type: STRING
        description: if any mean value is breaching the xbar ucl lcl limit, then this
          flag will be true
        sourceColumn: flag_xbar_ucl_lcl
        sourceTable: ""
      flag_rchart_ucl_lcl:
        type: STRING
        description: if any range value is breaching the rchart ucl lcl limit, then this
          flag will be true
        sourceColumn: flag_rchart_ucl_lcl
        sourceTable: ""
      flag_xchart_ucl_lcl:
        type: STRING
        description: if any mean value is breaching the xchart ucl lcl limit, then this
          flag will be true
        sourceColumn: flag_xchart_ucl_lcl
        sourceTable: ""
      flag_mrchart_ucl_lcl:
        type: STRING
        description: if any moving range value is breaching the rchart ucl lcl limit,
          then this flag will be true
        sourceColumn: flag_mrchart_ucl_lcl
        sourceTable: ""
      validation_usl_lsl:
        type: STRING
        description: flag to check if cp flag is greater than cpk
        sourceColumn: validation_usl_lsl
        sourceTable: ""
      cp_flag:
        type: STRING
        description: flag to categorise cp values in low, medium or high
        sourceColumn: cp_flag
        sourceTable: ""
      cpk_flag:
        type: STRING
        description: flag to categorise cpk values in low, medium or high
        sourceColumn: cpk_flag
        sourceTable: ""
      continous_flag_alert:
        type: STRING
        description: if mean value is increasing or decreasing continously for 7 days,
          this flag will be set to 1
        sourceColumn: continous_flag_alert
        sourceTable: ""
      alert_details:
        type: STRING
        description: categorise the alerts in beyond control limit, beyond spec limit,
          beyond control band, 7 points up or down
        sourceColumn: alert details
        sourceTable: ""
      _7_points_up:
        type: STRING
        description: if mean value is increasing continously for 7 days
        sourceColumn: _7_points_up
        sourceTable: ""
      _7_points_down:
        type: STRING
        description: if mean value is increasing decreasing for 7 days
        sourceColumn: _7_points_down
        sourceTable: ""
      runchart_ucl:
        type: STRING
        description: upper control band limit with 80% margin
        sourceColumn: runchart_ucl
        sourceTable: ""
      runchart_lcl:
        type: STRING
        description: lower control band limit with 80% margin
        sourceColumn: runchart_lcl
        sourceTable: ""
      flag_sample1_band:
        type: STRING
        description: sample 1 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample1_band
        sourceTable: ""
      flag_sample2_band:
        type: STRING
        description: sample 2 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample2_band
        sourceTable: ""
      flag_sample3_band:
        type: STRING
        description: sample 3 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample3_band
        sourceTable: ""
      flag_sample4_band:
        type: STRING
        description: sample 4 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample4_band
        sourceTable: ""
      flag_sample5_band:
        type: STRING
        description: sample 5 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample5_band
        sourceTable: ""
      flag_sample6_band:
        type: STRING
        description: sample 6 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample6_band
        sourceTable: ""
      flag_sample7_band:
        type: STRING
        description: sample 7 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample7_band
        sourceTable: ""
      flag_sample8_band:
        type: STRING
        description: sample 8 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample8_band
        sourceTable: ""
      flag_sample9_band:
        type: STRING
        description: sample 9 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample9_band
        sourceTable: ""
      flag_sample10_band:
        type: STRING
        description: sample 10 band if greater than lower spec limit but less than lower
          control limit
        sourceColumn: flag_sample10_band
        sourceTable: ""
      insp_smpl_feq:
        type: STRING
        description: smpl feq
        sourceColumn: insp_smpl_feq
        sourceTable: qacp_insp_item
      insp_part_rmrk:
        type: STRING
        description: part remarks
        sourceColumn: insp_part_rmrk
        sourceTable: qacp_insp_item
      insp_ctrl_limt:
        type: STRING
        description: control limit
        sourceColumn: insp_ctrl_limt
        sourceTable: qacp_insp_item
      insp_ctrl_point:
        type: STRING
        description: control point
        sourceColumn: insp_ctrl_point
        sourceTable: qacp_insp_item
      insp_ctrl_band:
        type: STRING
        description: control band
        sourceColumn: insp_ctrl_band
        sourceTable: qacp_insp_item
      insp_close_alrt:
        type: STRING
        description: close alert
        sourceColumn: insp_close_alrt
        sourceTable: qacp_insp_item
      insp_src:
        type: STRING
        description: source
        sourceColumn: insp_src
        sourceTable: qacp_insp_item
      insp_catg:
        type: STRING
        description: category
        sourceColumn: insp_catg
        sourceTable: qacp_insp_item
      insp_misp_plan:
        type: STRING
        description: misp plan
        sourceColumn: insp_misp_plan
        sourceTable: qacp_insp_item
      etl_inserted_date:
        type: DATETIME
        description: etl audit field to identify record insertion date
        sourceColumn: manual
        sourceTable: manual
      etl_modified_date:
        type: DATETIME
        description: etl audit field to identify record modified date
        sourceColumn: manual
        sourceTable: manual
      etl_created_by:
        type: STRING
        description: etl audit field to identify record created by user
        sourceColumn: manual
        sourceTable: manual
      etl_updated_by:
        type: STRING
        description: etl audit field to identify record modified by user
        sourceColumn: manual
        sourceTable: manual
  enforceSchemaMethod: ""
  isProfilingEnabled: true
transformation:
  - isDynamic: true
    alias: EMR_PySpark_1
    description: SADP to ADP Transformation
    sequence: 4
    arguments: []
    pythonFilePath: s3://msil-dataverse-quality-assurance/Pyspark_Scripts/critical_parameters/critical_parameter_details.py
    inputDataFrameList:
      - inputDataFrame: Employee_Master_1
        tempViewName: employee_master
      - inputDataFrame: Inspection_Item_Parameter_Detail_1
        tempViewName: inspection_item_parameter_detail
      - inputDataFrame: Parts_Accessories_Master_1
        tempViewName: parts_accessories_master
    optional:
      sparkExtraConf:
        --jars: s3://msil-data-lake-raw/InputData/Test/IMKT/test_iceberg_write/iceberg-core-1.4.3.jar,s3://msil-data-lake-raw/InputData/Test/IMKT/test_iceberg_write/iceberg-spark-runtime-3.3_2.12-1.4.3.jar,s3://msil-data-lake-raw/InputData/Test/IMKT/test_iceberg_write/iceberg-aws-bundle-1.4.3.jar,s3://msil-dataverse-quality-assurance/Temp_Dumps/delta-core_2.12-0.2.0.jar,s3://msil-dataverse-quality-assurance/Temp_Dumps/iceberg-spark3-runtime-0.13.2.jar
    type: customPySparkEMRServerless
controlPort:
  dataQualityRules:
    RecordCountCheck:
      productState:
        expression: ">"
        number: 0
        referenceAlias: Write_to_Iceberg
    NullValueCheck:
      productState:
        checks:
          - column: part_vend_code
          - column: insp_part_code
          - column: insp_item
          - column: tran_prod_date
        referenceAlias: Write_to_Iceberg
outputPort:
  subscriptionChannels:
    - channelType: Postgres
      queryType: SQL
    - channelType: Dataproduct
      queryType: SQL
